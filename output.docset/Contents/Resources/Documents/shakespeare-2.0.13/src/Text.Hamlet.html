<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css"></link><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-2" name="line-2"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-3" name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-4" name="line-4"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-5" name="line-5"></a><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-missing-fields #-}</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-6" name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Hamlet</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-7" name="line-7"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- * Plain HTML</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-8" name="line-8"></a><span>      </span><span class="hs-identifier hs-type">Html</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-9" name="line-9"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#shamlet"><span class="hs-identifier hs-var">shamlet</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-10" name="line-10"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#shamletFile"><span class="hs-identifier hs-var">shamletFile</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-11" name="line-11"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#xshamlet"><span class="hs-identifier hs-var">xshamlet</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-12" name="line-12"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#xshamletFile"><span class="hs-identifier hs-var">xshamletFile</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-13" name="line-13"></a><span>      </span><span class="hs-comment">-- * Hamlet</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-14" name="line-14"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#HtmlUrl"><span class="hs-identifier hs-type">HtmlUrl</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-15" name="line-15"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#Render"><span class="hs-identifier hs-type">Render</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-16" name="line-16"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#hamlet"><span class="hs-identifier hs-var">hamlet</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-17" name="line-17"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#hamletFile"><span class="hs-identifier hs-var">hamletFile</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-18" name="line-18"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#hamletFileReload"><span class="hs-identifier hs-var">hamletFileReload</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-19" name="line-19"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#xhamlet"><span class="hs-identifier hs-var">xhamlet</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-20" name="line-20"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#xhamletFile"><span class="hs-identifier hs-var">xhamletFile</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-21" name="line-21"></a><span>      </span><span class="hs-comment">-- * I18N Hamlet</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-22" name="line-22"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#HtmlUrlI18n"><span class="hs-identifier hs-type">HtmlUrlI18n</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-23" name="line-23"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#Translate"><span class="hs-identifier hs-type">Translate</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-24" name="line-24"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#ihamlet"><span class="hs-identifier hs-var">ihamlet</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-25" name="line-25"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#ihamletFile"><span class="hs-identifier hs-var">ihamletFile</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-26" name="line-26"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#ihamletFileReload"><span class="hs-identifier hs-var">ihamletFileReload</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-27" name="line-27"></a><span>      </span><span class="hs-comment">-- * Type classes</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-28" name="line-28"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#ToAttributes"><span class="hs-identifier hs-type">ToAttributes</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-29" name="line-29"></a><span>      </span><span class="hs-comment">-- * Internal, for making more</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-30" name="line-30"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#HamletSettings"><span class="hs-identifier hs-type">HamletSettings</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-31" name="line-31"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#NewlineStyle"><span class="hs-identifier hs-type">NewlineStyle</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-32" name="line-32"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#hamletWithSettings"><span class="hs-identifier hs-var">hamletWithSettings</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-33" name="line-33"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#hamletFileWithSettings"><span class="hs-identifier hs-var">hamletFileWithSettings</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-34" name="line-34"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#defaultHamletSettings"><span class="hs-identifier hs-var">defaultHamletSettings</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-35" name="line-35"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#xhtmlHamletSettings"><span class="hs-identifier hs-var">xhtmlHamletSettings</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-36" name="line-36"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-37" name="line-37"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#HamletRules"><span class="hs-identifier hs-type">HamletRules</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-38" name="line-38"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#hamletRules"><span class="hs-identifier hs-var">hamletRules</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-39" name="line-39"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#ihamletRules"><span class="hs-identifier hs-var">ihamletRules</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-40" name="line-40"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#htmlRules"><span class="hs-identifier hs-var">htmlRules</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-41" name="line-41"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#CloseStyle"><span class="hs-identifier hs-type">CloseStyle</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-42" name="line-42"></a><span>      </span><span class="hs-comment">-- * Used by generated code</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-43" name="line-43"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#condH"><span class="hs-identifier hs-var">condH</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-44" name="line-44"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#maybeH"><span class="hs-identifier hs-var">maybeH</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-45" name="line-45"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#asHtmlUrl"><span class="hs-identifier hs-var">asHtmlUrl</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-46" name="line-46"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#attrsToHtml"><span class="hs-identifier hs-var">attrsToHtml</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-47" name="line-47"></a><span>     </span><span class="hs-comment">-- * low-level</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-48" name="line-48"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#hamletFromString"><span class="hs-identifier hs-var">hamletFromString</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-49" name="line-49"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-50" name="line-50"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-51" name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html"><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Shakespeare</span><span class="hs-operator">.</span><span class="hs-identifier">Base</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-52" name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html"><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Hamlet</span><span class="hs-operator">.</span><span class="hs-identifier">Parse</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-53" name="line-53"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,9,0)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-54" name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span class="hs-operator">.</span><span class="hs-identifier">Syntax</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Module</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-55" name="line-55"></a><span class="hs-cpp">#else</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-56" name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span class="hs-operator">.</span><span class="hs-identifier">Syntax</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-57" name="line-57"></a><span class="hs-cpp">#endif</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-58" name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span class="hs-operator">.</span><span class="hs-identifier">Quote</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-59" name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isUpper</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isDigit</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-60" name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromMaybe</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-61" name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pack</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-62" name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TL</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-63" name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Blaze</span><span class="hs-operator">.</span><span class="hs-identifier">Html</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Html</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toHtml</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-64" name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Blaze</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">preEscapedText</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-65" name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">F</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-66" name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mplus</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-67" name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mconcat</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-68" name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">***</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-69" name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">intercalate</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-70" name="line-70"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-71" name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-72" name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-73" name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafePerformIO</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-74" name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Directory</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getModificationTime</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-75" name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">UTCTime</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-76" name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Blaze</span><span class="hs-operator">.</span><span class="hs-identifier">Html</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">preEscapedToHtml</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-77" name="line-77"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-78" name="line-78"></a><span class="hs-comment">-- | Convert some value to a list of attribute pairs.</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-79" name="line-79"></a><span class="hs-keyword">class</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#ToAttributes" name="ToAttributes"><a href="../shakespeare-2.0.13/Text.Hamlet.html#ToAttributes"><span class="hs-identifier">ToAttributes</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926811" name="local-6989586621679926811"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926811"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-80" name="line-80"></a><span>    </span><span class="hs-identifier">toAttributes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926811"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-81" name="line-81"></a><span class="hs-keyword">instance</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#ToAttributes"><span class="hs-identifier hs-type">ToAttributes</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-82" name="line-82"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-8214565720324701662" name="local-8214565720324701662"><a href="../shakespeare-2.0.13/Text.Hamlet.html#toAttributes"><span class="hs-identifier">toAttributes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-83" name="line-83"></a><span class="hs-keyword">instance</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#ToAttributes"><span class="hs-identifier hs-type">ToAttributes</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-84" name="line-84"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-8214565720324701662" name="local-8214565720324701662"><a href="../shakespeare-2.0.13/Text.Hamlet.html#toAttributes"><span class="hs-identifier">toAttributes</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679927154" name="local-6989586621679927154"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679927154"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679927155" name="local-6989586621679927155"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679927155"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">pack</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679927154"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pack</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679927155"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-85" name="line-85"></a><span class="hs-keyword">instance</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#ToAttributes"><span class="hs-identifier hs-type">ToAttributes</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-86" name="line-86"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-8214565720324701662" name="local-8214565720324701662"><a href="../shakespeare-2.0.13/Text.Hamlet.html#toAttributes"><span class="hs-identifier">toAttributes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-87" name="line-87"></a><span class="hs-keyword">instance</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#ToAttributes"><span class="hs-identifier hs-type">ToAttributes</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-88" name="line-88"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-8214565720324701662" name="local-8214565720324701662"><a href="../shakespeare-2.0.13/Text.Hamlet.html#toAttributes"><span class="hs-identifier">toAttributes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pack</span><span> </span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-identifier hs-var">pack</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-89" name="line-89"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-90" name="line-90"></a><span class="hs-identifier">attrsToHtml</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Html</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-91" name="line-91"></a><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#attrsToHtml" name="attrsToHtml"><a href="../shakespeare-2.0.13/Text.Hamlet.html#attrsToHtml"><span class="hs-identifier">attrsToHtml</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-92" name="line-92"></a><span>    </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926824"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-93" name="line-93"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-94" name="line-94"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926824" name="local-6989586621679926824"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926824"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926825" name="local-6989586621679926825"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926825"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926826" name="local-6989586621679926826"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926826"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926827" name="local-6989586621679926827"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926827"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-95" name="line-95"></a><span>        </span><span class="hs-identifier hs-var">toHtml</span><span> </span><span class="hs-string">&quot; &quot;</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-96" name="line-96"></a><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">preEscapedText</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926825"><span class="hs-identifier hs-var">k</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-97" name="line-97"></a><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">preEscapedText</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pack</span><span> </span><span class="hs-string">&quot;=\&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-98" name="line-98"></a><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toHtml</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926826"><span class="hs-identifier hs-var">v</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-99" name="line-99"></a><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">preEscapedText</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pack</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-100" name="line-100"></a><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926827"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-101" name="line-101"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-102" name="line-102"></a><span class="hs-keyword">type</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#Render" name="Render"><a href="../shakespeare-2.0.13/Text.Hamlet.html#Render"><span class="hs-identifier">Render</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926810" name="local-6989586621679926810"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926810"><span class="hs-identifier">url</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926810"><span class="hs-identifier hs-type">url</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-103" name="line-103"></a><span class="hs-keyword">type</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#Translate" name="Translate"><a href="../shakespeare-2.0.13/Text.Hamlet.html#Translate"><span class="hs-identifier">Translate</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926809" name="local-6989586621679926809"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926809"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926809"><span class="hs-identifier hs-type">msg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Html</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-104" name="line-104"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-105" name="line-105"></a><span class="hs-comment">-- | A function generating an 'Html' given a URL-rendering function.</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-106" name="line-106"></a><span class="hs-keyword">type</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#HtmlUrl" name="HtmlUrl"><a href="../shakespeare-2.0.13/Text.Hamlet.html#HtmlUrl"><span class="hs-identifier">HtmlUrl</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926808" name="local-6989586621679926808"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926808"><span class="hs-identifier">url</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#Render"><span class="hs-identifier hs-type">Render</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926808"><span class="hs-identifier hs-type">url</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Html</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-107" name="line-107"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-108" name="line-108"></a><span class="hs-comment">-- | A function generating an 'Html' given a message translator and a URL rendering function.</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-109" name="line-109"></a><span class="hs-keyword">type</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#HtmlUrlI18n" name="HtmlUrlI18n"><a href="../shakespeare-2.0.13/Text.Hamlet.html#HtmlUrlI18n"><span class="hs-identifier">HtmlUrlI18n</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926806" name="local-6989586621679926806"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926806"><span class="hs-identifier">msg</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926807" name="local-6989586621679926807"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926807"><span class="hs-identifier">url</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#Translate"><span class="hs-identifier hs-type">Translate</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926806"><span class="hs-identifier hs-type">msg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#Render"><span class="hs-identifier hs-type">Render</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926807"><span class="hs-identifier hs-type">url</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Html</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-110" name="line-110"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-111" name="line-111"></a><span class="hs-identifier">docsToExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#HamletRules"><span class="hs-identifier hs-type">HamletRules</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Exp</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-112" name="line-112"></a><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#docsToExp" name="docsToExp"><a href="../shakespeare-2.0.13/Text.Hamlet.html#docsToExp"><span class="hs-identifier">docsToExp</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926828" name="local-6989586621679926828"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926828"><span class="hs-identifier">env</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926829" name="local-6989586621679926829"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926829"><span class="hs-identifier">hr</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926830" name="local-6989586621679926830"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926830"><span class="hs-identifier">scope</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926831" name="local-6989586621679926831"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926831"><span class="hs-identifier">docs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-113" name="line-113"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926832" name="local-6989586621679926832"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926832"><span class="hs-identifier">exps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.html#docToExp"><span class="hs-identifier hs-var">docToExp</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926828"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926829"><span class="hs-identifier hs-var">hr</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926830"><span class="hs-identifier hs-var">scope</span></a><span class="hs-special">)</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926831"><span class="hs-identifier hs-var">docs</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-114" name="line-114"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926832"><span class="hs-identifier hs-var">exps</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-115" name="line-115"></a><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-116" name="line-116"></a><span>        </span><span class="hs-special">[</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926833" name="local-6989586621679926833"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926833"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926833"><span class="hs-identifier hs-var">x</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-117" name="line-117"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">DoE</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">NoBindS</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926832"><span class="hs-identifier hs-var">exps</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-118" name="line-118"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-119" name="line-119"></a><span class="hs-identifier">unIdent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-120" name="line-120"></a><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#unIdent" name="unIdent"><a href="../shakespeare-2.0.13/Text.Hamlet.html#unIdent"><span class="hs-identifier">unIdent</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Ident"><span class="hs-identifier hs-var">Ident</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926834" name="local-6989586621679926834"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926834"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926834"><span class="hs-identifier hs-var">s</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-121" name="line-121"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-122" name="line-122"></a><span class="hs-identifier">bindingPattern</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#Binding"><span class="hs-identifier hs-type">Binding</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Pat</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Exp</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-123" name="line-123"></a><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#bindingPattern" name="bindingPattern"><a href="../shakespeare-2.0.13/Text.Hamlet.html#bindingPattern"><span class="hs-identifier">bindingPattern</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#BindAs"><span class="hs-identifier hs-var">BindAs</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926835" name="local-6989586621679926835"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926835"><span class="hs-identifier">i</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Ident"><span class="hs-identifier hs-var">Ident</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926836" name="local-6989586621679926836"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926836"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926837" name="local-6989586621679926837"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926837"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-124" name="line-124"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926838" name="local-6989586621679926838"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926838"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newName</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926836"><span class="hs-identifier hs-var">s</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-125" name="line-125"></a><span>    </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926839" name="local-6989586621679926839"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926839"><span class="hs-identifier">pattern</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926840" name="local-6989586621679926840"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926840"><span class="hs-identifier">scope</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#bindingPattern"><span class="hs-identifier hs-var">bindingPattern</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926837"><span class="hs-identifier hs-var">b</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-126" name="line-126"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AsP</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926838"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926839"><span class="hs-identifier hs-var">pattern</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926835"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">VarE</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926838"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926840"><span class="hs-identifier hs-var">scope</span></a><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-127" name="line-127"></a><span class="hs-identifier">bindingPattern</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#BindVar"><span class="hs-identifier hs-var">BindVar</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926841" name="local-6989586621679926841"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926841"><span class="hs-identifier">i</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Ident"><span class="hs-identifier hs-var">Ident</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926842" name="local-6989586621679926842"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926842"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-128" name="line-128"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926842"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;_&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WildP</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-129" name="line-129"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier hs-var">isDigit</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926842"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-130" name="line-130"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitP</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">IntegerL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">read</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926842"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-131" name="line-131"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-132" name="line-132"></a><span>        </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926843" name="local-6989586621679926843"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926843"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newName</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926842"><span class="hs-identifier hs-var">s</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-133" name="line-133"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarP</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926843"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926841"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">VarE</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926843"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-134" name="line-134"></a><span class="hs-identifier">bindingPattern</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#BindTuple"><span class="hs-identifier hs-var">BindTuple</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926844" name="local-6989586621679926844"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926844"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-135" name="line-135"></a><span>    </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926845" name="local-6989586621679926845"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926845"><span class="hs-identifier">patterns</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926846" name="local-6989586621679926846"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926846"><span class="hs-identifier">scopes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#bindingPattern"><span class="hs-identifier hs-var">bindingPattern</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926844"><span class="hs-identifier hs-var">is</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-136" name="line-136"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TupP</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926845"><span class="hs-identifier hs-var">patterns</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926846"><span class="hs-identifier hs-var">scopes</span></a><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-137" name="line-137"></a><span class="hs-identifier">bindingPattern</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#BindList"><span class="hs-identifier hs-var">BindList</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926847" name="local-6989586621679926847"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926847"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-138" name="line-138"></a><span>    </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926848" name="local-6989586621679926848"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926848"><span class="hs-identifier">patterns</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926849" name="local-6989586621679926849"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926849"><span class="hs-identifier">scopes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#bindingPattern"><span class="hs-identifier hs-var">bindingPattern</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926847"><span class="hs-identifier hs-var">is</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-139" name="line-139"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListP</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926848"><span class="hs-identifier hs-var">patterns</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926849"><span class="hs-identifier hs-var">scopes</span></a><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-140" name="line-140"></a><span class="hs-identifier">bindingPattern</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#BindConstr"><span class="hs-identifier hs-var">BindConstr</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926850" name="local-6989586621679926850"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926850"><span class="hs-identifier">con</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926851" name="local-6989586621679926851"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926851"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-141" name="line-141"></a><span>    </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926852" name="local-6989586621679926852"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926852"><span class="hs-identifier">patterns</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926853" name="local-6989586621679926853"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926853"><span class="hs-identifier">scopes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#bindingPattern"><span class="hs-identifier hs-var">bindingPattern</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926851"><span class="hs-identifier hs-var">is</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-142" name="line-142"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConP</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.html#mkConName"><span class="hs-identifier hs-var">mkConName</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926850"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926852"><span class="hs-identifier hs-var">patterns</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926853"><span class="hs-identifier hs-var">scopes</span></a><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-143" name="line-143"></a><span class="hs-identifier">bindingPattern</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#BindRecord"><span class="hs-identifier hs-var">BindRecord</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926854" name="local-6989586621679926854"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926854"><span class="hs-identifier">con</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926855" name="local-6989586621679926855"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926855"><span class="hs-identifier">fields</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926856" name="local-6989586621679926856"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926856"><span class="hs-identifier">wild</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-144" name="line-144"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926857" name="local-6989586621679926857"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926857"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Ident"><span class="hs-identifier hs-var">Ident</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926858" name="local-6989586621679926858"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926858"><span class="hs-identifier">field</span></a></a><span class="hs-special">,</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926859" name="local-6989586621679926859"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926859"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-145" name="line-145"></a><span>           </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926860" name="local-6989586621679926860"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926860"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926861" name="local-6989586621679926861"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926861"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#bindingPattern"><span class="hs-identifier hs-var">bindingPattern</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926859"><span class="hs-identifier hs-var">b</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-146" name="line-146"></a><span>              </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkName</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926858"><span class="hs-identifier hs-var">field</span></a><span class="hs-special">,</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926860"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">,</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926861"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-147" name="line-147"></a><span>    </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926862" name="local-6989586621679926862"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926862"><span class="hs-identifier">patterns</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926863" name="local-6989586621679926863"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926863"><span class="hs-identifier">scopes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926857"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926855"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-148" name="line-148"></a><span>    </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926864" name="local-6989586621679926864"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926864"><span class="hs-identifier">patterns1</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926865" name="local-6989586621679926865"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926865"><span class="hs-identifier">scopes1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926856"><span class="hs-identifier hs-var">wild</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-149" name="line-149"></a><span>       </span><span class="hs-keyword">then</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#bindWildFields"><span class="hs-identifier hs-var">bindWildFields</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926854"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926855"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-150" name="line-150"></a><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-151" name="line-151"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecP</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.html#mkConName"><span class="hs-identifier hs-var">mkConName</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926854"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926862"><span class="hs-identifier hs-var">patterns</span></a><span class="hs-operator hs-var">++</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926864"><span class="hs-identifier hs-var">patterns1</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926863"><span class="hs-identifier hs-var">scopes</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926865"><span class="hs-identifier hs-var">scopes1</span></a><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-152" name="line-152"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-153" name="line-153"></a><span class="hs-identifier">mkConName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DataConstr"><span class="hs-identifier hs-type">DataConstr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-154" name="line-154"></a><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#mkConName" name="mkConName"><a href="../shakespeare-2.0.13/Text.Hamlet.html#mkConName"><span class="hs-identifier">mkConName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#conToStr"><span class="hs-identifier hs-var">conToStr</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-155" name="line-155"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-156" name="line-156"></a><span class="hs-identifier">conToStr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DataConstr"><span class="hs-identifier hs-type">DataConstr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-157" name="line-157"></a><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#conToStr" name="conToStr"><a href="../shakespeare-2.0.13/Text.Hamlet.html#conToStr"><span class="hs-identifier">conToStr</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DCUnqualified"><span class="hs-identifier hs-var">DCUnqualified</span></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Ident"><span class="hs-identifier hs-var">Ident</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926866" name="local-6989586621679926866"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926866"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926866"><span class="hs-identifier hs-var">x</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-158" name="line-158"></a><span class="hs-identifier">conToStr</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DCQualified"><span class="hs-identifier hs-var">DCQualified</span></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926867" name="local-6989586621679926867"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926867"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Ident"><span class="hs-identifier hs-var">Ident</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926868" name="local-6989586621679926868"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926868"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span> </span><span class="hs-string">&quot;.&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926867"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926868"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-159" name="line-159"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-160" name="line-160"></a><span class="hs-comment">-- Wildcards bind all of the unbound fields to variables whose name</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-161" name="line-161"></a><span class="hs-comment">-- matches the field name.</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-162" name="line-162"></a><span class="hs-comment">--</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-163" name="line-163"></a><span class="hs-comment">-- For example: data R = C { f1, f2 :: Int }</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-164" name="line-164"></a><span class="hs-comment">-- C {..}           is equivalent to   C {f1=f1, f2=f2}</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-165" name="line-165"></a><span class="hs-comment">-- C {f1 = a, ..}   is equivalent to   C {f1=a,  f2=f2}</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-166" name="line-166"></a><span class="hs-comment">-- C {f2 = a, ..}   is equivalent to   C {f1=f1, f2=a}</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-167" name="line-167"></a><span class="hs-identifier">bindWildFields</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DataConstr"><span class="hs-identifier hs-type">DataConstr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Pat</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Exp</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-168" name="line-168"></a><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#bindWildFields" name="bindWildFields"><a href="../shakespeare-2.0.13/Text.Hamlet.html#bindWildFields"><span class="hs-identifier">bindWildFields</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926869" name="local-6989586621679926869"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926869"><span class="hs-identifier">conName</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926870" name="local-6989586621679926870"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926870"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-169" name="line-169"></a><span>  </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926871" name="local-6989586621679926871"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926871"><span class="hs-identifier">fieldNames</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#recordToFieldNames"><span class="hs-identifier hs-var">recordToFieldNames</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926869"><span class="hs-identifier hs-var">conName</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-170" name="line-170"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926872" name="local-6989586621679926872"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926872"><span class="hs-identifier">available</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926873" name="local-6989586621679926873"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926873"><span class="hs-identifier">n</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926873"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#unIdent"><span class="hs-identifier hs-var">unIdent</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926870"><span class="hs-identifier hs-var">fields</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-171" name="line-171"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926874" name="local-6989586621679926874"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926874"><span class="hs-identifier">remainingFields</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926872"><span class="hs-identifier hs-var">available</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926871"><span class="hs-identifier hs-var">fieldNames</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-172" name="line-172"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926875" name="local-6989586621679926875"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926875"><span class="hs-identifier">mkPat</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926876" name="local-6989586621679926876"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926876"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-173" name="line-173"></a><span>        </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926877" name="local-6989586621679926877"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926877"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nameBase</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926876"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-174" name="line-174"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926876"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">VarP</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926877"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Ident"><span class="hs-identifier hs-var">Ident</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nameBase</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926876"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">VarE</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926877"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-175" name="line-175"></a><span>  </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926875"><span class="hs-identifier hs-var">mkPat</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926874"><span class="hs-identifier hs-var">remainingFields</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-176" name="line-176"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-177" name="line-177"></a><span class="hs-comment">-- Important note! reify will fail if the record type is defined in the</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-178" name="line-178"></a><span class="hs-comment">-- same module as the reify is used. This means quasi-quoted Hamlet</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-179" name="line-179"></a><span class="hs-comment">-- literals will not be able to use wildcards to match record types</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-180" name="line-180"></a><span class="hs-comment">-- defined in the same module.</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-181" name="line-181"></a><span class="hs-identifier">recordToFieldNames</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DataConstr"><span class="hs-identifier hs-type">DataConstr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-182" name="line-182"></a><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#recordToFieldNames" name="recordToFieldNames"><a href="../shakespeare-2.0.13/Text.Hamlet.html#recordToFieldNames"><span class="hs-identifier">recordToFieldNames</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926878" name="local-6989586621679926878"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926878"><span class="hs-identifier">conStr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-183" name="line-183"></a><span>  </span><span class="hs-comment">-- use 'lookupValueName' instead of just using 'mkName' so we reify the</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-184" name="line-184"></a><span>  </span><span class="hs-comment">-- data constructor and not the type constructor if their names match.</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-185" name="line-185"></a><span>  </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926879" name="local-6989586621679926879"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926879"><span class="hs-identifier">conName</span></a></a><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lookupValueName</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#conToStr"><span class="hs-identifier hs-var">conToStr</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926878"><span class="hs-identifier hs-var">conStr</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-186" name="line-186"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,11,0)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-187" name="line-187"></a><span>  </span><span class="hs-identifier hs-var">DataConI</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926880" name="local-6989586621679926880"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926880"><span class="hs-identifier">typeName</span></a></a><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reify</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926879"><span class="hs-identifier hs-var">conName</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-188" name="line-188"></a><span>  </span><span class="hs-identifier hs-var">TyConI</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926881" name="local-6989586621679926881"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926881"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reify</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926880"><span class="hs-identifier hs-var">typeName</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-189" name="line-189"></a><span class="hs-cpp">#else</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-190" name="line-190"></a><span>  </span><span class="hs-identifier">DataConI</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">typeName</span><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">reify</span><span> </span><span class="hs-identifier">conName</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-191" name="line-191"></a><span>  </span><span class="hs-identifier">TyConI</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DataD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">reify</span><span> </span><span class="hs-identifier">typeName</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-192" name="line-192"></a><span class="hs-cpp">#endif</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-193" name="line-193"></a><span>  </span><span class="hs-special">[</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926884" name="local-6989586621679926884"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926884"><span class="hs-identifier">fields</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926883"><span class="hs-identifier hs-var">fields</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">RecC</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926882" name="local-6989586621679926882"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926882"><span class="hs-identifier">name</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926883" name="local-6989586621679926883"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926883"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926881"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926882"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926879"><span class="hs-identifier hs-var">conName</span></a><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-194" name="line-194"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926885"><span class="hs-identifier hs-var">fieldName</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926885" name="local-6989586621679926885"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926885"><span class="hs-identifier">fieldName</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926884"><span class="hs-identifier hs-var">fields</span></a><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-195" name="line-195"></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-196" name="line-196"></a><span class="hs-identifier">docToExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#HamletRules"><span class="hs-identifier hs-type">HamletRules</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Scope"><span class="hs-identifier hs-type">Scope</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Exp</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-197" name="line-197"></a><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#docToExp" name="docToExp"><a href="../shakespeare-2.0.13/Text.Hamlet.html#docToExp"><span class="hs-identifier">docToExp</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926886" name="local-6989586621679926886"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926886"><span class="hs-identifier">env</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926887" name="local-6989586621679926887"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926887"><span class="hs-identifier">hr</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926888" name="local-6989586621679926888"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926888"><span class="hs-identifier">scope</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DocForall"><span class="hs-identifier hs-var">DocForall</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926889" name="local-6989586621679926889"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926889"><span class="hs-identifier">list</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926890" name="local-6989586621679926890"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926890"><span class="hs-identifier">idents</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926891" name="local-6989586621679926891"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926891"><span class="hs-identifier">inside</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-198" name="line-198"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926892" name="local-6989586621679926892"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926892"><span class="hs-identifier">list'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#derefToExp"><span class="hs-identifier hs-var">derefToExp</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926888"><span class="hs-identifier hs-var">scope</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926889"><span class="hs-identifier hs-var">list</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-199" name="line-199"></a><span>    </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926893" name="local-6989586621679926893"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926893"><span class="hs-identifier">pat</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926894" name="local-6989586621679926894"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926894"><span class="hs-identifier">extraScope</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#bindingPattern"><span class="hs-identifier hs-var">bindingPattern</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926890"><span class="hs-identifier hs-var">idents</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-200" name="line-200"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926895" name="local-6989586621679926895"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926895"><span class="hs-identifier">scope'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926894"><span class="hs-identifier hs-var">extraScope</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926888"><span class="hs-identifier hs-var">scope</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-201" name="line-201"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926896" name="local-6989586621679926896"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926896"><span class="hs-identifier">mh</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span class="hs-identifier hs-var">F</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapM_</span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-202" name="line-202"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926897" name="local-6989586621679926897"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926897"><span class="hs-identifier">inside'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#docsToExp"><span class="hs-identifier hs-var">docsToExp</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926886"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926887"><span class="hs-identifier hs-var">hr</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926895"><span class="hs-identifier hs-var">scope'</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926891"><span class="hs-identifier hs-var">inside</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-203" name="line-203"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926898" name="local-6989586621679926898"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926898"><span class="hs-identifier">lam</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LamE</span><span> </span><span class="hs-special">[</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926893"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">]</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926897"><span class="hs-identifier hs-var">inside'</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-204" name="line-204"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926896"><span class="hs-identifier hs-var">mh</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppE</span><span class="hs-special">`</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926898"><span class="hs-identifier hs-var">lam</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppE</span><span class="hs-special">`</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926892"><span class="hs-identifier hs-var">list'</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-205" name="line-205"></a><span class="hs-identifier">docToExp</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926899" name="local-6989586621679926899"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926899"><span class="hs-identifier">env</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926900" name="local-6989586621679926900"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926900"><span class="hs-identifier">hr</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926901" name="local-6989586621679926901"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926901"><span class="hs-identifier">scope</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DocWith"><span class="hs-identifier hs-var">DocWith</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926902" name="local-6989586621679926902"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926902"><span class="hs-identifier">inside</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-206" name="line-206"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926903" name="local-6989586621679926903"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926903"><span class="hs-identifier">inside'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#docsToExp"><span class="hs-identifier hs-var">docsToExp</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926899"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926900"><span class="hs-identifier hs-var">hr</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926901"><span class="hs-identifier hs-var">scope</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926902"><span class="hs-identifier hs-var">inside</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-207" name="line-207"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926903"><span class="hs-identifier hs-var">inside'</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-208" name="line-208"></a><span class="hs-identifier">docToExp</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926904" name="local-6989586621679926904"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926904"><span class="hs-identifier">env</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926905" name="local-6989586621679926905"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926905"><span class="hs-identifier">hr</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926906" name="local-6989586621679926906"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926906"><span class="hs-identifier">scope</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DocWith"><span class="hs-identifier hs-var">DocWith</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926907" name="local-6989586621679926907"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926907"><span class="hs-identifier">deref</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926908" name="local-6989586621679926908"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926908"><span class="hs-identifier">idents</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926909" name="local-6989586621679926909"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926909"><span class="hs-identifier">dis</span></a></a><span class="hs-special">)</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926910" name="local-6989586621679926910"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926910"><span class="hs-identifier">inside</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-209" name="line-209"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926911" name="local-6989586621679926911"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926911"><span class="hs-identifier">deref'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#derefToExp"><span class="hs-identifier hs-var">derefToExp</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926906"><span class="hs-identifier hs-var">scope</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926907"><span class="hs-identifier hs-var">deref</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-210" name="line-210"></a><span>    </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926912" name="local-6989586621679926912"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926912"><span class="hs-identifier">pat</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926913" name="local-6989586621679926913"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926913"><span class="hs-identifier">extraScope</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#bindingPattern"><span class="hs-identifier hs-var">bindingPattern</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926908"><span class="hs-identifier hs-var">idents</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-211" name="line-211"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926914" name="local-6989586621679926914"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926914"><span class="hs-identifier">scope'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926913"><span class="hs-identifier hs-var">extraScope</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926906"><span class="hs-identifier hs-var">scope</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-212" name="line-212"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926915" name="local-6989586621679926915"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926915"><span class="hs-identifier">inside'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#docToExp"><span class="hs-identifier hs-var">docToExp</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926904"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926905"><span class="hs-identifier hs-var">hr</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926914"><span class="hs-identifier hs-var">scope'</span></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DocWith"><span class="hs-identifier hs-var">DocWith</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926909"><span class="hs-identifier hs-var">dis</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926910"><span class="hs-identifier hs-var">inside</span></a><span class="hs-special">)</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-213" name="line-213"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926916" name="local-6989586621679926916"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926916"><span class="hs-identifier">lam</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LamE</span><span> </span><span class="hs-special">[</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926912"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">]</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926915"><span class="hs-identifier hs-var">inside'</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-214" name="line-214"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926916"><span class="hs-identifier hs-var">lam</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppE</span><span class="hs-special">`</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926911"><span class="hs-identifier hs-var">deref'</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-215" name="line-215"></a><span class="hs-identifier">docToExp</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926917" name="local-6989586621679926917"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926917"><span class="hs-identifier">env</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926918" name="local-6989586621679926918"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926918"><span class="hs-identifier">hr</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926919" name="local-6989586621679926919"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926919"><span class="hs-identifier">scope</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DocMaybe"><span class="hs-identifier hs-var">DocMaybe</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926920" name="local-6989586621679926920"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926920"><span class="hs-identifier">val</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926921" name="local-6989586621679926921"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926921"><span class="hs-identifier">idents</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926922" name="local-6989586621679926922"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926922"><span class="hs-identifier">inside</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926923" name="local-6989586621679926923"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926923"><span class="hs-identifier">mno</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-216" name="line-216"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926924" name="local-6989586621679926924"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926924"><span class="hs-identifier">val'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#derefToExp"><span class="hs-identifier hs-var">derefToExp</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926919"><span class="hs-identifier hs-var">scope</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926920"><span class="hs-identifier hs-var">val</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-217" name="line-217"></a><span>    </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926925" name="local-6989586621679926925"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926925"><span class="hs-identifier">pat</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926926" name="local-6989586621679926926"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926926"><span class="hs-identifier">extraScope</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#bindingPattern"><span class="hs-identifier hs-var">bindingPattern</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926921"><span class="hs-identifier hs-var">idents</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-218" name="line-218"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926927" name="local-6989586621679926927"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926927"><span class="hs-identifier">scope'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926926"><span class="hs-identifier hs-var">extraScope</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926919"><span class="hs-identifier hs-var">scope</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-219" name="line-219"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926928" name="local-6989586621679926928"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926928"><span class="hs-identifier">inside'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#docsToExp"><span class="hs-identifier hs-var">docsToExp</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926917"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926918"><span class="hs-identifier hs-var">hr</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926927"><span class="hs-identifier hs-var">scope'</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926922"><span class="hs-identifier hs-var">inside</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-220" name="line-220"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926929" name="local-6989586621679926929"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926929"><span class="hs-identifier">inside''</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LamE</span><span> </span><span class="hs-special">[</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926925"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">]</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926928"><span class="hs-identifier hs-var">inside'</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-221" name="line-221"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926933" name="local-6989586621679926933"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926933"><span class="hs-identifier">ninside'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926923"><span class="hs-identifier hs-var">mno</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-222" name="line-222"></a><span>                    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-223" name="line-223"></a><span>                    </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926930" name="local-6989586621679926930"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926930"><span class="hs-identifier">no</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-224" name="line-224"></a><span>                        </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926931" name="local-6989586621679926931"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926931"><span class="hs-identifier">no'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#docsToExp"><span class="hs-identifier hs-var">docsToExp</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926917"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926918"><span class="hs-identifier hs-var">hr</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926919"><span class="hs-identifier hs-var">scope</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926930"><span class="hs-identifier hs-var">no</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-225" name="line-225"></a><span>                        </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926932" name="local-6989586621679926932"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926932"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span class="hs-identifier hs-var">Just</span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-226" name="line-226"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926932"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppE</span><span class="hs-special">`</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926931"><span class="hs-identifier hs-var">no'</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-227" name="line-227"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926934" name="local-6989586621679926934"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926934"><span class="hs-identifier">mh</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><a href="../shakespeare-2.0.13/Text.Hamlet.html#maybeH"><span class="hs-identifier hs-var">maybeH</span></a><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-228" name="line-228"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926934"><span class="hs-identifier hs-var">mh</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppE</span><span class="hs-special">`</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926924"><span class="hs-identifier hs-var">val'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppE</span><span class="hs-special">`</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926929"><span class="hs-identifier hs-var">inside''</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppE</span><span class="hs-special">`</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926933"><span class="hs-identifier hs-var">ninside'</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-229" name="line-229"></a><span class="hs-identifier">docToExp</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926935" name="local-6989586621679926935"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926935"><span class="hs-identifier">env</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926936" name="local-6989586621679926936"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926936"><span class="hs-identifier">hr</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926937" name="local-6989586621679926937"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926937"><span class="hs-identifier">scope</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#DocCond"><span class="hs-identifier hs-var">DocCond</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926938" name="local-6989586621679926938"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926938"><span class="hs-identifier">conds</span></a></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926939" name="local-6989586621679926939"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926939"><span class="hs-identifier">final</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-230" name="line-230"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926945" name="local-6989586621679926945"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926945"><span class="hs-identifier">conds'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926940"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926938"><span class="hs-identifier hs-var">conds</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-231" name="line-231"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926949" name="local-6989586621679926949"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926949"><span class="hs-identifier">final'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926939"><span class="hs-identifier hs-var">final</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-232" name="line-232"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-233" name="line-233"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926946" name="local-6989586621679926946"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926946"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-234" name="line-234"></a><span>                    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926947" name="local-6989586621679926947"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926947"><span class="hs-identifier">f'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="../shakespeare-2.0.13/Text.Hamlet.html#docsToExp"><span class="hs-identifier hs-var">docsToExp</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926935"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926936"><span class="hs-identifier hs-var">hr</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926937"><span class="hs-identifier hs-var">scope</span></a><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926946"><span class="hs-identifier hs-var">f</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-235" name="line-235"></a><span>                    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926948" name="local-6989586621679926948"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926948"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span class="hs-identifier hs-var">Just</span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-236" name="line-236"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926948"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppE</span><span class="hs-special">`</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926947"><span class="hs-identifier hs-var">f'</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-237" name="line-237"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926950" name="local-6989586621679926950"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926950"><span class="hs-identifier">ch</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><a href="../shakespeare-2.0.13/Text.Hamlet.html#condH"><span class="hs-identifier hs-var">condH</span></a><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-238" name="line-238"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926950"><span class="hs-identifier hs-var">ch</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppE</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">ListE</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926945"><span class="hs-identifier hs-var">conds'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">AppE</span><span class="hs-special">`</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926949"><span class="hs-identifier hs-var">final'</span></a><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-239" name="line-239"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-240" name="line-240"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#Deref"><span class="hs-identifier hs-type">Deref</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#Doc"><span class="hs-identifier hs-type">Doc</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-identifier hs-type">Exp</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-241" name="line-241"></a><span>    </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926940" name="local-6989586621679926940"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926940"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926941" name="local-6989586621679926941"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926941"><span class="hs-identifier">d</span></a></a><span class="hs-special">,</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926942" name="local-6989586621679926942"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926942"><span class="hs-identifier">docs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#line-242" name="line-242"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926943" name="local-6989586621679926943"><a href="../shakespeare-2.0.13/src/Text.Hamlet.html#local-6989586621679926943"><span class="hs-identifier">d'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../shakespeare-2.0.13/Text.Shakespeare.Base.html#derefToExp"><span class="hs-identifier hs-var">derefToExp</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="../shakespeare-2.0.13/Text.Hamlet.Parse.html#specialOrIdent"><span class="hs-identifier hs-var">specialOrIdent</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">VarE</span><span> </span><span class="hs-char">'or):scope) d
        docs' &lt;- docsToExp env hr scope docs
        return $ TupE [d', docs']
docToExp env hr scope (DocCase deref cases) = do
    let exp_ = derefToExp scope deref
    matches &lt;- mapM toMatch cases
    return $ CaseE exp_ matches
  where
    toMatch :: (Binding, [Doc]) -&gt; Q Match
    toMatch (idents, inside) = do
        (pat, extraScope) &lt;- bindingPattern idents
        let scope' = extraScope ++ scope
        insideExp &lt;- docsToExp env hr scope' inside
        return $ Match pat (NormalB insideExp) []
docToExp env hr v (DocContent c) = contentToExp env hr v c

contentToExp :: Env -&gt; HamletRules -&gt; Scope -&gt; Content -&gt; Q Exp
contentToExp _ hr _ (ContentRaw s) = do
    os &lt;- [|preEscapedText . pack|]
    let s' = LitE $ StringL s
    return $ hrFromHtml hr `AppE` (os `AppE` s')
contentToExp _ hr scope (ContentVar d) = do
    str &lt;- [|toHtml|]
    return $ hrFromHtml hr `AppE` (str `AppE` derefToExp scope d)
contentToExp env hr scope (ContentUrl hasParams d) =
    case urlRender env of
        Nothing -&gt; error &quot;URL interpolation used, but no URL renderer provided&quot;
        Just wrender -&gt; wrender $ \render -&gt; do
            let render' = return render
            ou &lt;- if hasParams
                    then [|\(u, p) -&gt; $(render') u p|]
                    else [|\u -&gt; $(render') u []|]
            let d' = derefToExp scope d
            pet &lt;- [|toHtml|]
            return $ hrFromHtml hr `AppE` (pet `AppE` (ou `AppE` d'))
contentToExp env hr scope (ContentEmbed d) = hrEmbed hr env $ derefToExp scope d
contentToExp env hr scope (ContentMsg d) =
    case msgRender env of
        Nothing -&gt; error &quot;Message interpolation used, but no message renderer provided&quot;
        Just wrender -&gt; wrender $ \render -&gt;
            return $ hrFromHtml hr `AppE` (render `AppE` derefToExp scope d)
contentToExp _ hr scope (ContentAttrs d) = do
    html &lt;- [|attrsToHtml . toAttributes|]
    return $ hrFromHtml hr `AppE` (html `AppE` derefToExp scope d)

-- | &quot;Simple Hamlet&quot; quasi-quoter. May only be used to generate expressions.
--
-- Generated expressions have type 'Html'.
--
-- @
-- &gt;&gt;&gt; 'putStrLn' ('Text.Blaze.Html.Renderer.renderHtml' ['shamlet'|\&lt;div\&gt;Hello, world!|])
-- \&lt;div\&gt;Hello, world!\&lt;/div\&gt;
-- @
shamlet :: QuasiQuoter
shamlet = hamletWithSettings htmlRules defaultHamletSettings

-- | Like 'shamlet', but produces XHTML.
xshamlet :: QuasiQuoter
xshamlet = hamletWithSettings htmlRules xhtmlHamletSettings

htmlRules :: Q HamletRules
htmlRules = do
    i &lt;- [|id|]
    return $ HamletRules i ($ (Env Nothing Nothing)) (\_ b -&gt; return b)

-- | Hamlet quasi-quoter. May only be used to generate expressions.
--
-- Generated expression have type @'HtmlUrl' url@, for some @url@.
--
-- @
-- data MyRoute = Home
--
-- render :: 'Render' MyRoute
-- render Home _ = \&quot;/home\&quot;
--
-- &gt;&gt;&gt; 'putStrLn' ('Text.Blaze.Html.Renderer.String.renderHtml' (['hamlet'|\&lt;a href=@{Home}\&gt;Home|] render))
-- \&lt;a href=&quot;\/home&quot;\&gt;Home\&lt;\/a\&gt;
-- @
hamlet :: QuasiQuoter
hamlet = hamletWithSettings hamletRules defaultHamletSettings

-- | Like 'hamlet', but produces XHTML.
xhamlet :: QuasiQuoter
xhamlet = hamletWithSettings hamletRules xhtmlHamletSettings

asHtmlUrl :: HtmlUrl url -&gt; HtmlUrl url
asHtmlUrl = id

hamletRules :: Q HamletRules
hamletRules = do
    i &lt;- [|id|]
    let ur f = do
            r &lt;- newName &quot;_render&quot;
            let env = Env
                    { urlRender = Just ($ (VarE r))
                    , msgRender = Nothing
                    }
            h &lt;- f env
            return $ LamE [VarP r] h
    return $ HamletRules i ur em
  where
    em (Env (Just urender) Nothing) e = do
        asHtmlUrl' &lt;- [|asHtmlUrl|]
        urender $ \ur' -&gt; return ((asHtmlUrl' `AppE` e) `AppE` ur')
    em _ _ = error &quot;bad Env&quot;

-- | Hamlet quasi-quoter with internationalization. May only be used to generate
-- expressions.
--
-- Generated expressions have type @'HtmlUrlI18n' msg url@, for some @msg@ and
-- @url@.
--
-- @
-- data MyMsg = Hi | Bye
--
-- data MyRoute = Home
--
-- renderEnglish :: 'Translate' MyMsg
-- renderEnglish Hi  = \&quot;hi\&quot;
-- renderEnglish Bye = \&quot;bye\&quot;
--
-- renderUrl :: 'Render' MyRoute
-- renderUrl Home _ = \&quot;/home\&quot;
--
-- &gt;&gt;&gt; 'putStrLn' ('Text.Blaze.Html.Renderer.renderHtml' (['ihamlet'|@{Home} _{Hi} _{Bye}|] renderEnglish renderUrl))
-- \&lt;div\&gt;/home hi bye \&lt;div\&gt;
-- @
ihamlet :: QuasiQuoter
ihamlet = hamletWithSettings ihamletRules defaultHamletSettings

ihamletRules :: Q HamletRules
ihamletRules = do
    i &lt;- [|id|]
    let ur f = do
            u &lt;- newName &quot;_urender&quot;
            m &lt;- newName &quot;_mrender&quot;
            let env = Env
                    { urlRender = Just ($ (VarE u))
                    , msgRender = Just ($ (VarE m))
                    }
            h &lt;- f env
            return $ LamE [VarP m, VarP u] h
    return $ HamletRules i ur em
  where
    em (Env (Just urender) (Just mrender)) e =
          urender $ \ur' -&gt; mrender $ \mr -&gt; return (e `AppE` mr `AppE` ur')
    em _ _ = error &quot;bad Env&quot;

-- | Quasiquoter that follows XHTML serialization rules and supports i18n.
--
-- @since 2.0.10
ixhamlet :: QuasiQuoter
ixhamlet = hamletWithSettings ihamletRules xhtmlHamletSettings

hamletWithSettings :: Q HamletRules -&gt; HamletSettings -&gt; QuasiQuoter
hamletWithSettings hr set =
    QuasiQuoter
        { quoteExp = hamletFromString hr set
        }

data HamletRules = HamletRules
    { hrFromHtml :: Exp
    , hrWithEnv :: (Env -&gt; Q Exp) -&gt; Q Exp
    , hrEmbed :: Env -&gt; Exp -&gt; Q Exp
    }

data Env = Env
    { urlRender :: Maybe ((Exp -&gt; Q Exp) -&gt; Q Exp)
    , msgRender :: Maybe ((Exp -&gt; Q Exp) -&gt; Q Exp)
    }

hamletFromString :: Q HamletRules -&gt; HamletSettings -&gt; String -&gt; Q Exp
hamletFromString qhr set s = do
    hr &lt;- qhr
    hrWithEnv hr $ \env -&gt; docsToExp env hr [] $ docFromString set s

docFromString :: HamletSettings -&gt; String -&gt; [Doc]
docFromString set s =
    case parseDoc set s of
        Error s' -&gt; error s'
        Ok (_, d) -&gt; d

hamletFileWithSettings :: Q HamletRules -&gt; HamletSettings -&gt; FilePath -&gt; Q Exp
hamletFileWithSettings qhr set fp = do
#ifdef GHC_7_4
    qAddDependentFile fp
#endif
    contents &lt;- fmap TL.unpack $ qRunIO $ readUtf8File fp
    hamletFromString qhr set contents

-- | Like 'hamlet', but reads an external file at compile time.
--
-- @
-- $('hamletFile' \&quot;foo.hamlet\&quot;) :: 'HtmlUrl' MyRoute
-- @
hamletFile :: FilePath -&gt; Q Exp
hamletFile = hamletFileWithSettings hamletRules defaultHamletSettings

-- | Like 'hamletFile', but the external file is parsed at runtime. Allows for
-- more rapid development, but should not be used in production.
hamletFileReload :: FilePath -&gt; Q Exp
hamletFileReload = hamletFileReloadWithSettings runtimeRules defaultHamletSettings
  where runtimeRules = HamletRuntimeRules { hrrI18n = False }

-- | Like 'ihamletFile', but the external file is parsed at runtime. Allows for
-- more rapid development, but should not be used in production.
ihamletFileReload :: FilePath -&gt; Q Exp
ihamletFileReload = hamletFileReloadWithSettings runtimeRules defaultHamletSettings
  where runtimeRules = HamletRuntimeRules { hrrI18n = True }

-- | Like 'hamletFile', but produces XHTML.
xhamletFile :: FilePath -&gt; Q Exp
xhamletFile = hamletFileWithSettings hamletRules xhtmlHamletSettings

-- | Like 'shamlet', but reads an external file at compile time.
--
-- @
-- $('shamletFile' \&quot;foo.hamlet\&quot;) :: 'Html'
-- @
shamletFile :: FilePath -&gt; Q Exp
shamletFile = hamletFileWithSettings htmlRules defaultHamletSettings

-- | Like 'shamletFile', but produces XHTML.
xshamletFile :: FilePath -&gt; Q Exp
xshamletFile = hamletFileWithSettings htmlRules xhtmlHamletSettings

-- | Like 'ihamlet', but reads an external file at compile time.
--
-- @
-- $('ihamletFile' \&quot;foo.hamlet\&quot;) :: 'HtmlUrlI18n' MyMsg MyRoute
-- @
ihamletFile :: FilePath -&gt; Q Exp
ihamletFile = hamletFileWithSettings ihamletRules defaultHamletSettings

varName :: Scope -&gt; String -&gt; Exp
varName _ &quot;&quot; = error &quot;Illegal empty varName&quot;
varName scope v@(_:_) = fromMaybe (strToExp v) $ lookup (Ident v) scope

strToExp :: String -&gt; Exp
strToExp s@(c:_)
    | all isDigit s = LitE $ IntegerL $ read s
    | isUpper c = ConE $ mkName s
    | otherwise = VarE $ mkName s
strToExp &quot;&quot; = error &quot;strToExp on empty string&quot;

-- | Checks for truth in the left value in each pair in the first argument. If
-- a true exists, then the corresponding right action is performed. Only the
-- first is performed. In there are no true values, then the second argument is
-- performed, if supplied.
condH :: Monad m =&gt; [(Bool, m ())] -&gt; Maybe (m ()) -&gt; m ()
condH bms mm = fromMaybe (return ()) $ lookup True bms `mplus` mm

-- | Runs the second argument with the value in the first, if available.
-- Otherwise, runs the third argument, if available.
maybeH :: Monad m =&gt; Maybe v -&gt; (v -&gt; m ()) -&gt; Maybe (m ()) -&gt; m ()
maybeH mv f mm = fromMaybe (return ()) $ fmap f mv `mplus` mm


type MTime = UTCTime
data VarType = VTPlain | VTUrl | VTUrlParam | VTMixin | VTMsg | VTAttrs

type QueryParameters = [(Text, Text)]
type RenderUrl url   = (url -&gt; QueryParameters -&gt; Text)
type Shakespeare url = RenderUrl url -&gt; Html
data VarExp msg url  = EPlain Html
                     | EUrl url
                     | EUrlParam (url, QueryParameters)
                     | EMixin (HtmlUrl url)
                     | EMixinI18n (HtmlUrlI18n msg url)
                     | EMsg msg

instance Show (VarExp msg url) where
  show (EPlain html) = &quot;EPlain&quot;
  show (EUrl url) = &quot;EUrl&quot;
  show (EUrlParam url) = &quot;EUrlParam&quot;
  show (EMixin url) = &quot;EMixin&quot;
  show (EMixinI18n msg_url) = &quot;EMixinI18n&quot;
  show (EMsg msg) = &quot;EMsg&quot;

getVars :: Content -&gt; [(Deref, VarType)]
getVars ContentRaw{}     = []
getVars (ContentVar d)   = [(d, VTPlain)]
getVars (ContentUrl False d) = [(d, VTUrl)]
getVars (ContentUrl True d) = [(d, VTUrlParam)]
getVars (ContentEmbed d) = [(d, VTMixin)]
getVars (ContentMsg d)   = [(d, VTMsg)]
getVars (ContentAttrs d) = [(d, VTAttrs)]

hamletUsedIdentifiers :: HamletSettings -&gt; String -&gt; [(Deref, VarType)]
hamletUsedIdentifiers settings =
    concatMap getVars . contentFromString settings


data HamletRuntimeRules = HamletRuntimeRules {
                            hrrI18n :: Bool
                          }

hamletFileReloadWithSettings :: HamletRuntimeRules
                             -&gt; HamletSettings -&gt; FilePath -&gt; Q Exp
hamletFileReloadWithSettings hrr settings fp = do
    s &lt;- readFileQ fp
    let b = hamletUsedIdentifiers settings s
    c &lt;- mapM vtToExp b
    rt &lt;- if hrrI18n hrr
      then [|hamletRuntimeMsg settings fp|]
      else [|hamletRuntime settings fp|]
    return $ rt `AppE` ListE c
  where
    vtToExp :: (Deref, VarType) -&gt; Q Exp
    vtToExp (d, vt) = do
        d' &lt;- lift d
        c' &lt;- toExp vt
        return $ TupE [d', c' `AppE` derefToExp [] d]
      where
        toExp = c
          where
            c :: VarType -&gt; Q Exp
            c VTAttrs = [|EPlain . attrsToHtml . toAttributes|]
            c VTPlain = [|EPlain . toHtml|]
            c VTUrl = [|EUrl|]
            c VTUrlParam = [|EUrlParam|]
            c VTMixin = [|\r -&gt; EMixin $ \c -&gt; r c|]
            c VTMsg = [|EMsg|]

-- move to Shakespeare.Base?
readFileUtf8 :: FilePath -&gt; IO String
readFileUtf8 fp = fmap TL.unpack $ readUtf8File fp

-- move to Shakespeare.Base?
readFileQ :: FilePath -&gt; Q String
readFileQ fp = qRunIO $ readFileUtf8 fp

{-# NOINLINE reloadMapRef #-}
reloadMapRef :: IORef (M.Map FilePath (MTime, [Content]))
reloadMapRef = unsafePerformIO $ newIORef M.empty

lookupReloadMap :: FilePath -&gt; IO (Maybe (MTime, [Content]))
lookupReloadMap fp = do
  reloads &lt;- readIORef reloadMapRef
  return $ M.lookup fp reloads

insertReloadMap :: FilePath -&gt; (MTime, [Content]) -&gt; IO [Content]
insertReloadMap fp (mt, content) = atomicModifyIORef reloadMapRef
  (\reloadMap -&gt; (M.insert fp (mt, content) reloadMap, content))

contentFromString :: HamletSettings -&gt; String -&gt; [Content]
contentFromString set = map justContent . docFromString set
  where
    unsupported msg = error $ &quot;hamletFileReload does not support &quot; ++ msg

    justContent :: Doc -&gt; Content
    justContent (DocContent c) = c
    justContent DocForall{} = unsupported &quot;$forall&quot;
    justContent DocWith{} = unsupported &quot;$with&quot;
    justContent DocMaybe{} = unsupported &quot;$maybe&quot;
    justContent DocCase{} = unsupported &quot;$case&quot;
    justContent DocCond{} = unsupported &quot;attribute conditionals&quot;


hamletRuntime :: HamletSettings
              -&gt; FilePath
              -&gt; [(Deref, VarExp msg url)]
              -&gt; Shakespeare url
hamletRuntime settings fp cd render = unsafePerformIO $ do
    mtime &lt;- qRunIO $ getModificationTime fp
    mdata &lt;- lookupReloadMap fp
    case mdata of
      Just (lastMtime, lastContents) -&gt;
        if mtime == lastMtime then return $ go' lastContents
          else fmap go' $ newContent mtime
      Nothing -&gt; fmap go' $ newContent mtime
  where
    newContent mtime = do
        s &lt;- readFileUtf8 fp
        insertReloadMap fp (mtime, contentFromString settings s)

    go' = mconcat . map (runtimeContentToHtml cd render (error &quot;I18n embed IMPOSSIBLE&quot;) handleMsgEx)
    handleMsgEx _ = error &quot;i18n _{} encountered, but did not use ihamlet&quot;

type RuntimeVars msg url = [(Deref, VarExp msg url)]
hamletRuntimeMsg :: HamletSettings
              -&gt; FilePath
              -&gt; RuntimeVars msg url
              -&gt; HtmlUrlI18n msg url
hamletRuntimeMsg settings fp cd i18nRender render = unsafePerformIO $ do
    mtime &lt;- qRunIO $ getModificationTime fp
    mdata &lt;- lookupReloadMap fp
    case mdata of
      Just (lastMtime, lastContents) -&gt;
        if mtime == lastMtime then return $ go' lastContents
          else fmap go' $ newContent mtime
      Nothing -&gt; fmap go' $ newContent mtime
  where
    newContent mtime = do
        s &lt;- readFileUtf8 fp
        insertReloadMap fp (mtime, contentFromString settings s)

    go' = mconcat . map (runtimeContentToHtml cd render i18nRender handleMsg)
    handleMsg d = case lookup d cd of
            Just (EMsg s) -&gt; i18nRender s
            _ -&gt; nothingError &quot;EMsg for ContentMsg&quot; d

nothingError :: Show a =&gt; String -&gt; a -&gt; b
nothingError expected d = error $ &quot;expected &quot; ++ expected ++ &quot; but got Nothing for: &quot; ++ show d

runtimeContentToHtml :: RuntimeVars msg url -&gt; Render url -&gt; Translate msg -&gt; (Deref -&gt; Html) -&gt; Content -&gt; Html
runtimeContentToHtml cd render i18nRender handleMsg = go
  where
    go :: Content -&gt; Html
    go (ContentMsg d) = handleMsg d
    go (ContentRaw s) = preEscapedToHtml s
    go (ContentAttrs d) =
        case lookup d cd of
            Just (EPlain s) -&gt; s
            _ -&gt; error $ show d ++ &quot;: expected EPlain for ContentAttrs&quot;
    go (ContentVar d) =
        case lookup d cd of
            Just (EPlain s) -&gt; s
            _ -&gt; error $ show d ++ &quot;: expected EPlain for ContentVar&quot;
    go (ContentUrl False d) =
        case lookup d cd of
            Just (EUrl u) -&gt; toHtml $ render u []
            Just wrong -&gt; error $  &quot;expected EUrl but got: &quot; ++ show wrong ++ &quot;\nfor: &quot; ++ show d
            _ -&gt; nothingError &quot;EUrl&quot; d
    go (ContentUrl True d) =
        case lookup d cd of
            Just (EUrlParam (u, p)) -&gt;
                toHtml $ render u p
            _ -&gt; error $ show d ++ &quot;: expected EUrlParam&quot;
    go (ContentEmbed d) = case lookup d cd of
        Just (EMixin m) -&gt; m render
        Just (EMixinI18n m) -&gt; m i18nRender render
        _ -&gt; error $ show d ++ &quot;: expected EMixin&quot;
</span></pre></body></html>